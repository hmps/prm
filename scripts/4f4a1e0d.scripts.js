"use strict";angular.module("prmApp",["ngCookies","ngResource","ngSanitize","ngRoute","firebase"]).config(["$routeProvider",function(a){a.when("/login",{templateUrl:"views/login.html",authRequired:!1}).when("/",{redirectTo:"/players"}).when("/add",{templateUrl:"views/editPerson.html",authRequired:!0}).when("/players",{templateUrl:"views/listPersons.html",authRequired:!0}).when("/players/:personId",{templateUrl:"views/viewPerson.html",authRequired:!0}).when("/players/:personId/edit",{templateUrl:"views/editPerson.html",authRequired:!0}).otherwise({redirectTo:"/"})}]).run(["angularFireAuth","FBURL","$rootScope",function(a,b,c){a.initialize(new Firebase(b),{scope:c,name:"auth",path:"/login"}),c.FBURL=b}]).constant("FBURL","http://griffins-prm.firebaseio.com"),angular.module("prmApp").factory("fireRefService",["FBURL","Firebase",function(a,b){return{user:function(){return new b(a+"/users")},person:function(){return new b(a+"/persons")},category:function(){return new b(a+"/categories")},status:function(){return new b(a+"/status")},position:function(){return new b(a+"/positions")}}}]),angular.module("prmApp").factory("personService",["angularFireCollection","fireRefService",function(a,b){return{collection:function(c){return a(b.person(),c)},find:function(a){return b.person().child("/"+a)},create:function(a,c){var d={};return angular.forEach(a,function(a,b){d[b]=a}),d.log=[{date:Date.now(),data:a.name+" registrerades i systemet"}],d.created_at=Date.now(),d.updated_at=Date.now(),d.deleted_at="",console.log(d),b.person().push(d,c).name()},removePerson:function(){}}}]),angular.module("prmApp").factory("breadcrumbs",["$rootScope","$location",function(a,b){var c=[],d={};return a.$on("$routeChangeSuccess",function(){var a,d=b.path().split("/"),e=[],f=function(a){return"#/"+d.slice(0,a+1).join("/")};for(d.shift(),a=0;a<d.length;a++)e.push({name:d[a],path:f(a)});c=e}),d.getAll=function(){return c},d.getFirst=function(){return c[0]||{}},d}]),angular.module("prmApp").factory("categoryService",["angularFireCollection","fireRefService",function(a,b){return{collection:function(c){return a(b.category(),c)},find:function(a){return b.category().child("/"+a)}}}]),angular.module("prmApp").factory("statusService",["angularFireCollection","fireRefService",function(a,b){return{collection:function(c){return a(b.status(),c)},find:function(a){return b.status().child("/"+a)}}}]),angular.module("prmApp").factory("positionService",["angularFireCollection","fireRefService",function(a,b){return{collection:function(c){return a(b.position(),c)},find:function(a){return b.position().child("/"+a)}}}]),angular.module("prmApp").factory("loginService",["angularFireAuth","$location","$rootScope",function(a,b){return{login:function(c,d,e,f){var g=a.login("password",{email:c,password:d,rememberMe:!0});g.then(function(a){e&&b.path(e),f&&f(null,a)},f)},logout:function(c){a.logout(),b.path(c)}}}]),angular.module("prmApp").controller("MainCtrl",["$scope","$route","breadcrumbs","loginService",function(a,b,c,d){a.breadcrumbs=c,a.logout=function(){d.logout("/login")}}]),angular.module("prmApp").controller("PersonCtrl",["$scope","$rootScope","$routeParams","$route","angularFire","personService","categoryService","statusService","positionService",function(a,b,c,d,e,f,g,h,i){a.listOrder="name",a.id=c.personId,a.newEntry={},a.addEntry={active:!1,source:{mail:!1,phone:!1,fb:!1,other:!1}},a.classes={mail:"entypo-paper-plane",phone:"entypo-phone",fb:"entypo-facebook-squared",other:"entypo-chat"},a.persons=f.collection(),a.categories=g.collection(),a.statuses=h.collection(),a.positions=i.collection(),a.$watch("search.position",function(){null===this.last&&(a.search.position="")}),a.addNew=function(){f.create(a.person)},a.getPlayer=function(b){void 0===b&&c.personId&&(b=c.personId),b&&e(f.find(b),a,"person").then(function(){a.person.image||(a.person.image="http://www.bitrebels.com/wp-content/uploads/2011/02/Original-Facebook-Geek-Profile-Avatar-1.jpg"),a.person.id=b,a.person.category||(a.person.category={}),console.log(a.person.log)})},a.logThat=function(){a.person.log||(a.person.log=[]),console.log(a.person.log),console.log(a.newEntry),a.person.log.push({date:Date.now(),data:a.newEntry.text,source:a.newEntry.source}),a.person.updated_at=Date.now()},a.updateSearch=function(b){a.search.category=b},a.setActiveSource=function(b){a.addEntry.active=!0,angular.forEach(a.addEntry.source,function(b,c){a.addEntry.source[c]=!1}),a.addEntry.source[b]=!0,a.newEntry.source=b},a.cancelEntry=function(){a.addEntry.active=!1,angular.forEach(a.addEntry.source,function(b,c){a.addEntry.source[c]=!1})}}]),angular.module("prmApp").controller("LoginCtrl",["$scope","loginService","$location",function(a,b,c){a.auth&&c.path("/"),a.$on("angularFireAuth:login",function(){c.path("/")}),a.email=null,a.pass=null,a.name=null,a.login=function(c){a.err=null,b.login(a.email,a.pass,"/",function(b,d){a.err=b||null,"function"==typeof c&&c(b,d)})}}]);